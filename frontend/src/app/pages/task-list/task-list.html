<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Lista de Tarefas</h2>
    <button class="btn btn-success" [routerLink]="['/tasks/new']">
      <i class="bi bi-plus-lg"></i> Nova Tarefa
    </button>
  </div>

  <div class="card p-3 mb-3 bg-light">
    <div class="row g-3">
      <div class="col-md-2">
        <input type="number" class="form-control" placeholder="ID" [(ngModel)]="filtro.id">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" placeholder="Título" [(ngModel)]="filtro.titulo">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" placeholder="Responsável" [(ngModel)]="filtro.responsavel">
      </div>
      <div class="col-md-2">
        <select class="form-select" [(ngModel)]="filtro.situacao">
          <option value="">Todas</option>
          <option value="EM_ANDAMENTO">Em Andamento</option>
          <option value="CONCLUIDA">Concluída</option>
        </select>
      </div>
      <div class="col-md-2 d-flex gap-2">
        <button class="btn btn-primary w-100" (click)="buscarTarefas()">Buscar</button>
        <button class="btn btn-outline-secondary" (click)="limparFiltros()">Limpar</button>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center my-3">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>

  <table class="table table-striped table-hover" *ngIf="!isLoading">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Título</th>
        <th>Responsável</th>
        <th>Situação</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let task of tasks">
        <td>{{ task.id }}</td>
        <td>{{ task.titulo }}</td>
        <td>{{ task.responsavel }}</td>
        <td>
          <span [class]="task.situacao === 'CONCLUIDA' ? 'badge bg-success' : 'badge bg-warning text-dark'">
            {{ task.situacao }}
          </span>
        </td>
        <td>
          <button *ngIf="task.situacao !== 'CONCLUIDA'" 
                  class="btn btn-sm btn-success me-1" 
                  (click)="concludeTask(task)" title="Concluir">
            <i class="bi bi-check-lg"></i>
          </button>

          <button [routerLink]="['/tasks/edit', task.id]" 
                  class="btn btn-sm btn-primary me-1" title="Editar">
            <i class="bi bi-pencil"></i>
          </button>

          <button class="btn btn-sm btn-danger" 
                  (click)="deleteTask(task.id!)" title="Excluir">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>
      <tr *ngIf="tasks.length === 0">
        <td colspan="5" class="text-center">Nenhuma tarefa encontrada.</td>
      </tr>
    </tbody>
  </table>
</div>